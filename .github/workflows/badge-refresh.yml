name: refresh-badges
permissions:
  contents: write
on:
  push:
    paths: ["source/**/*.c"]
  workflow_dispatch:
  schedule:
    - cron: '0 2 * * *'

jobs:
  labs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }
      - name: Count labs via git
        id: count
        run: |
          echo "labs=$(git ls-files 'source/**/*.c' | wc -l)" >> $GITHUB_OUTPUT
      - name: Update JSON badge
        run: |
          jq -n --arg labs "${{ steps.count.outputs.labs }}" '{lab_count:$labs}' > labs.json
      - name: Publish badge
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: .
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
